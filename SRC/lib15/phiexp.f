      real*8 function phiexp( r )
c  Copyright (C) 2014, Jerry Sellwood
      implicit none
c gravitiational potential in the plane of a full mass exponential disc
c
c calling argument
      real*8 r
c
c common block
c
c      common / phiexpl / rad, zed
c      real*8 rad, zed
c
c externals
      real*8 algrng2
c, phiexz
c
c local arrays
      integer ntab
      parameter ( ntab = 100 )
      real*8 x( ntab + 1 ), y( ntab + 1 )
c
c local variables
      integer i
c, iuse, j
c
      data x /  0.00, 0.01, 0.02, 0.03, 0.04, 0.05, 0.06, 0.07, 0.08,
     +          0.09, 0.10, 0.11, 0.12, 0.13, 0.14, 0.15, 0.16, 0.17,
     +          0.18, 0.19, 0.20, 0.21, 0.22, 0.23, 0.24, 0.25, 0.26,
     +          0.27, 0.28, 0.29, 0.30, 0.31, 0.32, 0.33, 0.34, 0.35,
     +          0.36, 0.37, 0.38, 0.39, 0.40, 0.41, 0.42, 0.43, 0.44,
     +          0.45, 0.46, 0.47, 0.48, 0.49, 0.50, 0.51, 0.52, 0.53,
     +          0.54, 0.55, 0.56, 0.57, 0.58, 0.59, 0.60, 0.61, 0.62,
     +          0.63, 0.64, 0.65, 0.66, 0.67, 0.68, 0.69, 0.70, 0.71,
     +          0.72, 0.73, 0.74, 0.75, 0.76, 0.77, 0.78, 0.79, 0.80,
     +          0.81, 0.82, 0.83, 0.84, 0.85, 0.86, 0.87, 0.88, 0.89,
     +          0.90, 0.91, 0.92, 0.93, 0.94, 0.95, 0.96, 0.97, 0.98,
     +          0.99, 1.00 /
      data ( y( i ), i = 1, 51 ) /
     +  -1.000000000000000, -1.009961767988022, -1.019908678829500,
     +  -1.029871306685798, -1.039863692745984, -1.049894543260099,
     +  -1.059969845265903, -1.070093926322398, -1.080269984511347,
     +  -1.090500384879565, -1.100786843699991, -1.111130539691518,
     +  -1.121532193479650, -1.131992113102808, -1.142510231668311,
     +  -1.153086123919408, -1.163719019101327, -1.174407807676834,
     +  -1.185151038262894, -1.195946912579103, -1.206793278312751,
     +  -1.217687616447279, -1.228627024643490, -1.239608199354454,
     +  -1.250627416069547, -1.261680505781252, -1.272762827747658,
     +  -1.283869240265040, -1.294994070037281, -1.306131078568106,
     +  -1.317273424134919, -1.328413620461206, -1.339543494137581,
     +  -1.350654139715127, -1.361735869110664, -1.372778156188930,
     +  -1.383769581173927, -1.394697772495534, -1.405549339313200,
     +  -1.416309801367340, -1.426963521779523, -1.437493627507759,
     +  -1.447881924908571, -1.458108823534564, -1.468153239296752,
     +  -1.477992505022703, -1.487602278115829, -1.496956432586717,
     +  -1.506026970542832, -1.514783905097053, -1.523195171643202 /
      data ( y( i ), i = 52, 101 ) /
     +  -1.531226513602966, -1.538841389968199, -1.546000882392716,
     +  -1.552663600388332, -1.558785615046211, -1.564320398067791,
     +  -1.569218780002019, -1.573428940814784, -1.576896435032427,
     +  -1.579564259934436, -1.581372979307924, -1.582260916472317,
     +  -1.582164432708282, -1.581018309054930, -1.578756247968806,
     +  -1.575311529899489, -1.570617859018381, -1.564610383499441,
     +  -1.557227013679141, -1.548409976634183, -1.538107719749903,
     +  -1.526277173785458, -1.512886408007470, -1.497917711889785,
     +  -1.481371081421494, -1.463268157435261, -1.443656435222571,
     +  -1.422613723625239, -1.400252554380823, -1.376724170114677,
     +  -1.352221659787915, -1.326981381798585, -1.301281876902746,
     +  -1.275438992668008, -1.249796062110041, -1.224708018912300,
     +  -1.200518819115287, -1.177532970471146, -1.155983921697153,
     +  -1.136005413178778, -1.117614640663156, -1.100717141392927,
     +  -1.085138861135967, -1.070678079397347, -1.057155096447018,
     +  -1.044435300360626, -1.032423410187037, -1.021048658105657,
     +  -1.010255703400224, -1.000000000000000 /
c
c      if( iuse .eq. 0 )then
cc create table
c        print *, 'building a table for potential of an exponential disc'
c        zed = 0
c        do j = 1, ntab
c          i = j - 1
cc uniform spacing in r / ( 1 + r )
c          rad = dble( i ) / dble( ntab - i )
c          x( j ) = dble( i ) / dble( ntab )
c          y( j ) = phiexz( rad, zed ) * ( 1. + rad )
c        end do
cc end value
c        x( ntab + 1 ) = 1
c        y( ntab + 1 ) = -1
c        iuse = 1
c        print *, 'table ready'
c      end if
c look up value in table
      phiexp = algrng2( x, y, ntab + 1, r / ( 1. + r ) ) / ( 1. + r )
      return
      end
